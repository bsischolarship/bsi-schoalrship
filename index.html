<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Home | Inspirasi BSI Scholarship ‚Äî Batch 5</title>
<link rel="stylesheet" href="assets/style.css" />

<style>
/* ================= HERO BUTTON ================= */
.hero-actions{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  justify-content:center;
}
.hero-btn{
  display:flex;
  flex-direction:column;
  gap:4px;
  padding:14px 18px 14px 22px;
  border-radius:16px;
  position:relative;
  text-decoration:none;
  min-width:220px;
}
.hero-btn::before{
  content:"";
  position:absolute;
  left:0; top:8px; bottom:8px;
  width:6px;
  border-radius:8px;
}
.hero-btn.blue{background:#eef5ff;color:#003b73}
.hero-btn.blue::before{background:#0055A5}
.hero-btn.yellow{background:#fff6db;color:#5c4a00}
.hero-btn.yellow::before{background:#f4c430}

/* ================= KPI ================= */
.kpi-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
  margin-top:26px;
}
@media(max-width:768px){
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
}
.kpi-blue{background:#eaf2fb}
.kpi-yellow{background:#fff7db}

/* ================= TABLE ================= */
.frame-2col{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:24px;
  margin-top:30px;
}
@media(max-width:900px){
  .frame-2col{grid-template-columns:1fr}
}
.data-card{
  background:#fff;
  border-radius:16px;
  overflow:hidden;
}
.data-head{
  padding:14px 16px;
  font-weight:700;
}
.data-head.good{background:#e9f8f3}
.data-head.bad{background:#fdecea}
.data-body{padding:10px 16px 16px}

table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:8px;border-bottom:1px solid #eee}
th{text-align:center}
td.center{text-align:center}

.rank{font-weight:700}
.top1{background:#e8f8f5}
.top2{background:#f1fcfa}
.top3{background:#f7fffd}

/* ================= PROGRESS ================= */
.progress-wrap{
  display:flex;
  align-items:center;
  gap:8px;
}
.progress{
  flex:1;
  height:6px;
  background:#eee;
  border-radius:4px;
}
.progress>div{
  height:100%;
  border-radius:4px;
}
.good-bar{background:#1abc9c}
.bad-bar{background:#e74c3c}
.percent{
  min-width:42px;
  text-align:center;
  font-weight:600;
}

.hero--dashboard {
    text-align: center;
}

.hero-card-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
    margin-top: 28px;
}

.hero-card {
    background: #fff;
    border-radius: 14px;
    padding: 16px 18px;
    text-align: left;
    box-shadow: 0 6px 18px rgba(0,0,0,.06);
    transition: all .25s ease;
    border-left: 6px solid transparent;
}

.hero-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 26px rgba(0,0,0,.12);
}

.hero-card-header {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 6px;
}

.hero-card-icon {
    width: 28px;
    height: 28px;
    color: inherit;
    flex-shrink: 0;
}

.hero-card-icon path {
    fill: currentColor;
}

.hero-card-title {
    font-size: 15px;
    line-height: 1.3;
    margin: 2px 0 0 0;
    font-weight: 600;
}

.hero-card-text {
    font-size: 13px;
    color: #555;
}

/* VARIANT WARNA */
.hero-card--blue {
    border-left-color: #0055a5;
    color: #0055a5;
}

.hero-card--teal {
    border-left-color: #00a79d;
    color: #00a79d;
}

.hero-card--yellow {
    border-left-color: #f5b400;
    color: #7a5a00;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .hero-card-grid {
        grid-template-columns: 1fr;
    }

    .hero-card {
        padding: 14px 16px;
    }
}


/* ================= CLICKABLE ROW ================= */
.click-row{
  cursor:pointer;
}
.click-row:hover{
  background:#f5faff !important;
}
</style>
</head>

<body data-page="home">

<header class="topbar">
  <div class="topbar-inner">
    <a href="index.html" class="brand">
      <img src="assets/logo.png" class="brand-logo">
      <div class="brand-text">
        <div class="brand-title">Inspirasi BSI Scholarship</div>
        <div class="brand-batch">Batch 5</div>
      </div>
    </a>
    <button class="nav-toggle" onclick="toggleNav()">‚ò∞</button>
    <nav class="nav" id="mobileNav">
      <a href="index.html" class="nav-link nav-link--active">Home</a>
      <a href="list-form.html" class="nav-link">List Form</a>
      <a href="rekap.html" class="nav-link">Rekap Aktivitas</a>
      <a href="ganti-nomor.html" class="nav-link">Kendala</a>
    </nav>
  </div>
</header>

<main class="page page--full">

<section class="hero hero--compact hero--dashboard">

    <div class="hero-badge">Hi, Sharia Young Leader!</div>

    <h1 class="hero-title">
        Bagaimana aktivitasmu hari ini?
    </h1>

    <p class="hero-subtitle">
        Ringkasan dihitung otomatis dari data rekap kehadiran awardee.
    </p>

    <!-- ACTION CARDS -->
    <div class="hero-card-grid">

        <!-- LIHAT SEMUA FORM -->
        <a href="list-form.html" class="hero-card hero-card--blue">
            <div class="hero-card-header">
                <svg class="hero-card-icon" viewBox="0 0 24 24">
                    <path d="M4 4h16v2H4zm0 5h16v2H4zm0 5h10v2H4z"/>
                </svg>
                <h3 class="hero-card-title">Lihat Semua Form</h3>
            </div>
            <p class="hero-card-text">
                Isi & cek seluruh form aktivitas.
            </p>
        </a>

        <!-- AWARDEE PORTAL -->
        <a href="https://sites.google.com/view/awardee-portal"
        class="hero-card hero-card--teal"
        target="_blank"
        rel="noopener noreferrer">
            <div class="hero-card-header">
                <svg class="hero-card-icon" viewBox="0 0 24 24">
                    <path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0 2c-4 0-8 2-8 5v3h16v-3c0-3-4-5-8-5z"/>
                </svg>
                <h3 class="hero-card-title">Awardee Portal</h3>
            </div>
            <p class="hero-card-text">
                Informasi & pembinaan resmi.
            </p>
        </a>

        <!-- REKAP AKTIVITAS -->
        <a href="rekap.html" class="hero-card hero-card--yellow">
            <div class="hero-card-header">
                <svg class="hero-card-icon" viewBox="0 0 24 24">
                    <path d="M3 17h3v-7H3zm5 0h3V7H8zm5 0h3v-4h-3zm5 0h3V4h-3z"/>
                </svg>
                <h3 class="hero-card-title">Rekap Aktivitas</h3>
            </div>
            <p class="hero-card-text">
                Detail kehadiran & evaluasi.
            </p>
        </a>

    </div>
</section>

<section class="kpi-grid">
  <div class="card card--kpi kpi-blue"><div>Total Peserta</div><strong id="kpiPeserta">‚Äî</strong></div>
  <div class="card card--kpi kpi-yellow"><div>Total Aktivitas</div><strong id="kpiAktivitas">‚Äî</strong></div>
  <div class="card card--kpi kpi-blue"><div>Rata-rata Kehadiran</div><strong id="kpiRate">‚Äî%</strong></div>
  <div class="card card--kpi kpi-yellow"><div>Total Kampus</div><strong id="kpiCampus">‚Äî</strong></div>
</section>

<section class="frame-2col">
  <div class="data-card">
    <div class="data-head good">üèÜ Top 10 Peserta Paling Aktif</div>
    <div class="data-body"><table id="tblPesertaTop"></table></div>
  </div>
  <div class="data-card">
    <div class="data-head bad">üìï Top 10 Peserta Kurang Aktif</div>
    <div class="data-body"><table id="tblPesertaLow"></table></div>
  </div>

  <div class="data-card">
    <div class="data-head good">üè´ Top 10 Kampus Paling Aktif</div>
    <div class="data-body"><table id="tblKampusTop"></table></div>
  </div>
  <div class="data-card">
    <div class="data-head bad">üè´ Kampus Kurang Aktif</div>
    <div class="data-body"><table id="tblKampusLow"></table></div>
  </div>

  <div class="data-card">
    <div class="data-head good">üë• Top 10 Kelompok Paling Aktif</div>
    <div class="data-body"><table id="tblKelompokTop"></table></div>
  </div>
  <div class="data-card">
    <div class="data-head bad">üë• Kelompok Kurang Aktif</div>
    <div class="data-body"><table id="tblKelompokLow"></table></div>
  </div>
</section>

</main>

<nav class="mobile-bottom-nav">
  <a href="index.html" class="mb-item active">
    <svg viewBox="0 0 24 24" class="mb-icon">
      <path d="M3 10.5L12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-10.5z"/>
    </svg>
    <span class="mb-label">Home</span>
  </a>

  <a href="list-form.html" class="mb-item">
    <svg viewBox="0 0 24 24" class="mb-icon">
      <path d="M4 4h16v2H4V4zm0 5h16v2H4V9zm0 5h10v2H4v-2z"/>
    </svg>
    <span class="mb-label">List Form</span>
  </a>

  <a href="rekap.html" class="mb-item">
    <svg viewBox="0 0 24 24" class="mb-icon">
      <path d="M3 13h4v8H3v-8zm7-6h4v14h-4V7zm7-4h4v18h-4V3z"/>
    </svg>
    <span class="mb-label">Rekap</span>
  </a>

  <a href="ganti-nomor.html" class="mb-item">
    <svg viewBox="0 0 24 24" class="mb-icon">
      <path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0 2c-4 0-8 2-8 5v3h16v-3c0-3-4-5-8-5z"/>
    </svg>
    <span class="mb-label">Kendala</span>
  </a>
</nav>

<footer class="footer">
  <div class="footer-inner">&copy; 2025 BSI Scholarship Hub</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="scripts/main.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const sb = window.supabaseClient;
  if (!sb) return;

  window.goRekap = function(type, value){
    window.location.href =
      `rekap.html?type=${type}&value=${encodeURIComponent(value)}`;
  }

  const PAGE = 1000;
  let from = 0, rows = [];

  while (true) {
    const { data } = await sb
      .from("rekap_bsi")
      .select("no_induk,nama,kampus,kelompok,pre_test,post_test,assessment,mentoring,pembinaan")
      .range(from, from + PAGE - 1);

    if (!data || !data.length) break;
    rows.push(...data);
    from += PAGE;
  }

  const isH = v => v === "‚úÖ" || v === "TP";
  const peserta = {};
  const kampus = {};
  const kelompok = {};
  let totalAct = 0, totalHad = 0;

  rows.forEach(r => {
    const hadir = [r.pre_test,r.post_test,r.assessment,r.mentoring,r.pembinaan].filter(isH).length;
    totalAct += 5;
    totalHad += hadir;

    peserta[r.no_induk] ??= { nama:r.nama, hadir:0, total:0 };
    peserta[r.no_induk].hadir += hadir; peserta[r.no_induk].total += 5;

    kampus[r.kampus] ??= { nama:r.kampus, hadir:0, total:0 };
    kampus[r.kampus].hadir += hadir; kampus[r.kampus].total += 5;

    kelompok[r.kelompok] ??= { nama:r.kelompok, hadir:0, total:0 };
    kelompok[r.kelompok].hadir += hadir; kelompok[r.kelompok].total += 5;
  });

  const sortFn = (a,b)=> (b.hadir/b.total)-(a.hadir/a.total) || b.hadir-a.hadir;

  const arrPeserta = Object.values(peserta).map(x=>({...x,rate:x.hadir/x.total})).sort(sortFn);
  const arrKampus  = Object.values(kampus).map(x=>({...x,rate:x.hadir/x.total})).sort(sortFn);
  const arrKelompok= Object.values(kelompok).map(x=>({...x,rate:x.hadir/x.total})).sort(sortFn);

  kpiPeserta.textContent = Object.keys(peserta).length;
  kpiAktivitas.textContent = totalAct;
  kpiRate.textContent = Math.round(totalHad/totalAct*100)+"%";
  kpiCampus.textContent = Object.keys(kampus).length;

  function render(el, arr, type){
    let h = "<tr><th>#</th><th>Nama</th><th>Hadir</th><th>Perc.</th></tr>";
    arr.slice(0,10).forEach((a,i)=>{
      const pct = Math.round(a.rate*100);
      const icon = i===0?"ü•á":i===1?"ü•à":i===2?"ü•â":(i+1);

      h += `
      <tr class="click-row ${i<3?`top${i+1}`:""}"
          onclick="goRekap('${type}','${a.nama}')">
        <td class="center rank">${icon}</td>
        <td><strong>${a.nama}</strong></td>
        <td class="center">${a.hadir} dari ${a.total}</td>
        <td>
          <div class="progress-wrap">
            <div class="progress">
              <div class="${type==='peserta'?'good-bar':'bad-bar'}"
                   style="width:${pct}%"></div>
            </div>
            <span class="percent">${pct}%</span>
          </div>
        </td>
      </tr>`;
    });
    el.innerHTML = h;
  }

  render(tblPesertaTop, arrPeserta, "peserta");
  render(tblPesertaLow, arrPeserta.slice().reverse(), "peserta");
  render(tblKampusTop, arrKampus, "kampus");
  render(tblKampusLow, arrKampus.slice().reverse(), "kampus");
  render(tblKelompokTop, arrKelompok, "kelompok");
  render(tblKelompokLow, arrKelompok.slice().reverse(), "kelompok");
});
</script>

</body>
</html>
